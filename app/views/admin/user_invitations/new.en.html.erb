<% provide :title, "Invite users to Technovation" %>

<div class="grid">
  <div class="grid__col-10">
    <h1>Invite a user to the platform</h1>

    <div class="panel">
      <%= form_with model: [:admin, @user_invitation], local: true do |f| %>
        <% if @user_invitation.errors.any? %>
          <div class="notice notice--error">
            <ul class="reset">
              <% @user_invitation.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="field">
          <%= f.label :profile_type %>
          <%= f.select :profile_type,
            UserInvitation.profile_types.keys.map { |k| [k.titleize, k] },
            {},
            id: "user_invitation_profile_type" %>
        </div>

        <div class="field">
          <%= f.label :email %>
          <%= f.email_field :email, id: "user_invitation_email" %>
        </div>

        <div class="actions">
          <p>
            <%= f.submit "Send invitation", class: "button" %>
          </p>
        </div>
      <% end %>

      <% if @user_invitation.errors[:email].any? { |e| e.include?("taken") } %>
        <% @existing = UserInvitation.find_by(email: @user_invitation.email) %>

        <h6>Existing invitation:</h6>

        <table class="datagrid">
          <thead>
            <tr>
              <th>Profile type</th>
              <th>Email</th>
              <th>Account</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <%= render "admin/user_invitations/user_invitation_row",
                invitation: @existing %>
            </tr>
          </tbody>
        </table>

        <p>
          <%= link_to "View all",
            admin_user_invitations_path,
            class: "small secondary button" %>
        </p>
      <% end %>
    </div>
  </div>
</div>
