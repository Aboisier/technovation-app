<% provide :title, "RA Data â€¢ Participants" %>

<% provide :subnav, render('regional_ambassador/participants/sub_menu') %>

<div class="panel">
  <%= datagrid_form_for @accounts_grid,
    data: { turbolinks: false },
    url: regional_ambassador_participants_path %>

  <h6><%= pluralize(@accounts_grid.assets.count, "account") %> found</h6>

  <% unless @accounts_grid.assets.empty? %>
    <p>
      <%= link_to "Export current results to CSV", "#",
        data: {
          opens_modal: "export_csv",
        },
        class: "button secondary small" %>
    </p>
  <% end %>

  <%= datagrid_table(@accounts_grid) %>

  <%= will_paginate @accounts_grid.assets %>
</div>

<%= content_tag :div, class: "modal", id: "export_csv" do %>
  <div class="modal-content">
    <div style="text-align: left;">
      <h5 class="reset">Current export settings:</h5>

      <p class="hint">
        Make sure you performed the search to get the desired settings!
      </p>
    </div>

    <dl style="text-align: left;">
      <% @accounts_grid.attributes.each do |name, value| %>
        <% next if value.blank? %>
        <% filter = @accounts_grid.filters.detect { |f| f.name == name } %>
        <% next unless filter.present? %>

        <dt><%= filter.header %></dt>
        <dd><%= Array(value).to_sentence %></dd>
      <% end %>

      <dt>Total accounts</dt>
      <dd><%= @accounts_grid.assets.count %></dd>
    </dl>

    <%= form_with(
      method: :get,
      local: true,
      url: url_for(
        format: 'csv',
        accounts_grid: params[:accounts_grid].to_unsafe_h
      )
    ) do |f| %>

      <%= f.label :filename, "Customize the filename (optional)" %>
      <%= f.text_field :filename, placeholder: default_export_filename(:csv) %>

      <p>
        <%= f.submit "Export now", class: "button" %>
        or
        <%= link_to 'cancel', '#', class: "close" %>
      </p>
    <% end %>
  </div>
<% end %>
