<% provide :title, "#{@team_submission.app_name} by #{@team.name}" %>

<div class="grid">
  <div class="grid__col-sm-3 col--sticky-parent">
    <div class="col--sticky-spacer">
      <div class="col--sticky">
        <div class="submission-sidebar">
          <%= render "team_submissions/team_info",
            submission: @team_submission,
            team: @team %>

          <div class="panel">
            <h6>Pitch</h6>

            <p>
              <%= link_to web_icon(
                  "play-circle-o",
                  text: "Watch the demo video"
                ),
                "#",
                data: {
                  opens_modal: "video-modal-" +
                                @team_submission.video_id(:demo),
                  modal_fetch: send(
                    "#{current_scope}_embed_code_path",
                    @team_submission,
                    piece: :demo,
                  ),
                } %>
            </p>

            <div
              class="modal"
              id="video-modal-<%= @team_submission.video_id(:demo) %>"
            >
              <div class="modal-content"></div>
            </div>

            <p>
              <%= link_to web_icon(
                  "play-circle-o",
                  text: "Watch the pitch video"

                ),
                "#",
                data: {
                  opens_modal: "video-modal-" +
                                @team_submission.video_id(:pitch),
                  modal_fetch: send(
                    "#{current_scope}_embed_code_path",
                    @team_submission,
                    piece: :pitch,
                  ),
                } %>
            </p>

            <div
              class="modal"
              id="video-modal-<%= @team_submission.video_id(:pitch) %>"
            >
              <div class="modal-content"></div>
            </div>

            <h6>Code</h6>

            <p>
              <%= link_to web_icon(
                "code",
                text: "Download the source code",
                remote: true,
                size: 12,
                color: "5ABF94",
              ),
              @team_submission.source_code_url %>
            </p>

            <h6>Business</h6>

            <p>
              <% if @team.senior? %>
                <%= link_to web_icon(
                    "briefcase",
                    text: "Read the business plan",
                    remote: true,
                    size: 12,
                    color: "5ABF94",
                  ),
                  @team_submission.business_plan_url,
                  target: :_blank %>
              <% else %>
                Junior teams do not upload a business plan
              <% end %>
            </p>

            <h6>Reigonal Pitch Events</h6>

            <p>
              <% if @team.live_event? %>
                <%= link_to web_icon(
                    "area-chart",
                    text: "See the presentation slides",
                    remote: true,
                    size: 12,
                    color: "5ABF94",
                  ),
                  @team_submission.pitch_presentation_url,
                  target: :_blank %>
              <% else %>
                Virtual judging teams do not upload presentation slides
              <% end %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid__col-sm-9">
    <h3 class="submission-title">
      <%= @team_submission.app_name %>
    </h3>

    <%= simple_format @team_submission.app_description %>

    <div class="submission-pieces__screenshots">
      <% @team_submission.screenshots.each do |screenshot| %>
        <div class="submission-pieces__screenshot img-modal">
          <%= image_tag screenshot.image_url,
            data: {
              modal_url: screenshot.image_url(:large),
            } %>
        </div>
      <% end %>
    </div>

    <h3 class="heading--reset">Code checklist</h3>

    <p>
      <%= @team.name %> earned
      <strong>
        <%= pluralize(
          @team_submission.total_technical_checklist,
          "point"
        ) %>
      </strong>
      for their code checklist.
    </p>

    <h4 class="code_checklist-header">
      Technical Components
    </h4>

    <% if @team_submission.code_checklist.technical.any? %>
      <dl>
        <% @team_submission.code_checklist.technical.each do |item| %>
          <dt><%= item.label %></dt>
          <dd><%= item.explanation %></dd>
        <% end %>
      </dl>
    <% else %>
      <p>No use of technical components was indicated.</p>
    <% end %>

    <h4 class="code_checklist-header">
      Databases and Connectivity
    </h4>

    <% if @team_submission.code_checklist.database.any? %>
      <dl>
        <% @team_submission.code_checklist.database.each do |item| %>
          <dt><%= item.label %></dt>
          <dd><%= item.explanation %></dd>
        <% end %>
      </dl>
    <% else %>
      <p>No use of database and connectivity was indicated.</p>
    <% end %>

    <h4 class="code_checklist-header">
      Mobile Features
    </h4>

    <% if @team_submission.code_checklist.mobile.any? %>
      <dl>
        <% @team_submission.code_checklist.mobile.each do |item| %>
          <dt><%= item.label %></dt>
          <dd><%= item.explanation %></dd>
        <% end %>
      </dl>
    <% else %>
      <p>No use of mobile features was indicated.</p>
    <% end %>

    <h4 class="code_checklist-header">
      Pictures of the process
    </h4>

    <% if @team_submission.code_checklist.process.any? %>
      <dl>
        <% @team_submission.code_checklist.process.each do |item| %>
          <dt><%= item.label %></dt>

          <dd class="img-modal">
            <%= image_tag item.display,
              class: "thumbnail-md thumbnail-process-pic",
              data: {
                modal_url: item.display,
              } %>
          </dd>
        <% end %>
      </dl>
    <% else %>
      <p>No pictures of the process were uploaded.</p>
    <% end %>
  </div>

  <div class="grid__col-auto submission-footer">
    <% @team_submission.awaiting_publish do %>
      <p>
        <%= link_to "Submit now",
          [
            current_scope,
            :honor_code_review,
            { team_id: current_team.id },
          ],

          class: "button" %>

        or

        <%= link_to "continue editing",
          [
            current_scope,
            @team_submission,
            :section,
            section: :ideation
          ] %>
      </p>
    <% end %>

    <% @team_submission.already_published do %>
      <% if SeasonToggles.team_submissions_editable? %>
        <p>
          You can make changes until <%= Season.deadline %>.
        </p>

        <p>
          <%= link_to "Make changes",
            [
              current_scope,
              @team_submission,
              :section,
              section: :ideation
            ],
            class: "button button--small" %>
        </p>
      <% else %>
        <p>Submissions are not editable at this time.</p>
      <% end %>
    <% end %>
  </div>
</div>
